/*!
    scriptive -- Javascript application service
    v1.0.2
    https://scriptive.github.io/core
    (c) 2016
*/
!function(os,win,doc){"use strict";var ob="app",obUnique=":unique",Config={},app={todo:{1:"a"},init:function(a){var id=typeof a;if(app.fn.hasOwnProperty(id))return app.fn[id](a)},ready:function(callback){doc.addEventListener("DOMContentLoaded",callback,!1)},fn:{object:function(o){return app.root.merge(o)},string:function(n){return ob=n,win[n]=app.root}},device:{platform:{is:function(needle){return navigator.userAgent.toLowerCase().indexOf(needle)!==-1},ios:function(){return this.iphone()||this.ipod()||this.ipad()},iphone:function(){return!this.windows()&&this.is("iphone")},ipod:function(){return this.is("ipod")},ipad:function(){return this.is("ipad")},android:function(){return!this.windows()&&this.is("android")},ADP:function(){return this.android()&&this.is("mobile")},ADT:function(){return this.android()&&!this.is("mobile")},blackberry:function(){return this.is("blackberry")||this.is("bb10")||this.is("rim")},BBP:function(){return this.blackberry()&&!this.is("tablet")},BBT:function(){return this.blackberry()&&this.is("tablet")},windows:function(){return this.is("windows")},WDP:function(){return this.windows()&&this.is("phone")},WDT:function(){return this.windows()&&this.is("touch")&&!this.WDP()},fxos:function(){return(this.is("(mobile;")||this.is("(tablet;"))&&this.is("; rv:")},FFP:function(){return this.fxos()&&this.is("mobile")},FFT:function(){return this.fxos()&&this.is("tablet")},meego:function(){return this.is("meego")},cordova:function(){return win.cordova&&"file:"===location.protocol},chrome:function(){return"chrome"===Config.Platform},nodeWebkit:function(){return"object"==typeof window.process},mobile:function(){return this.ADP()||this.iphone()||this.ipod()||this.WDP()||this.BBP()||this.FFP()||this.meego()},tablet:function(){return this.ipad()||this.ADT()||this.BBT()||this.WDT()||this.FFT()}},agent:function(fileMeta){var fileAgent=[],fileTemplate=[],name={desktop:"desktop",tablet:"tablet",mobile:"mobile",ios:"ios",android:"android",defaults:"default",web:"web",app:"app"};if(Config.isCordova=this.platform.cordova(),Config.isChrome=this.platform.chrome(),Config.Platform||(Config.Platform=name.web),Config.Screen||(Config.Screen=name.desktop),this.platform.mobile()?Config.Screen=name.mobile:this.platform.tablet()&&(Config.Screen=name.tablet),this.platform.ios()?Config.Device=name.ios:this.platform.android()?Config.Device=name.android:this.platform.hasMethodProperty(Config.Device)||(Config.Device=name.defaults),"object"==typeof Config.DeviceAgent)for(var i in Config.DeviceAgent){var iName=Config.DeviceAgent[i];Config.hasOwnProperty(iName)?fileAgent.push(Config[iName]):"string"==typeof iName&&fileAgent.push(iName)}else fileAgent.push(Config.Platform,Config.Screen,Config.Device);if("object"==typeof Config.DeviceTemplate)for(var i in Config.DeviceTemplate){var iName=Config.DeviceTemplate[i];Config.hasOwnProperty(iName)?fileTemplate.push(Config[iName]):"string"==typeof iName&&fileTemplate.push(iName)}else Config.Platform==name.web?fileTemplate.push(name.defaults,Config.Screen):fileTemplate.push(Config.Device,Config.Screen);Config.DeviceTemplate=fileTemplate;var file=[],fileName=[];if("object"==typeof fileMeta)for(var id in fileAgent){fileName.push(fileAgent[id]);for(var fileType in fileMeta)fileMeta.hasOwnProperty(fileType)&&"object"==typeof fileMeta[fileType]&&fileMeta[fileType].filter(function(i){return i==id}).length&&file.push({type:fileType,name:fileName.join(".")})}return file},orientate:function(evt){win.addEventListener?win.addEventListener(evt,this.setAttribute,!1):win.attachEvent?win.attachEvent(evt,this.setAttribute):win[evt]=this.setAttribute,this.setAttribute()},setAttribute:function(){doc.querySelector(Config.Orientation.html).setAttribute("class",win.innerHeight<win.innerWidth?Config.Orientation.landscape:Config.Orientation.portrait)}},hash:function(){var q,r=this.root.config.hash,obj=win.location.hash.split("?");if(obj.length){for(var hash=obj[0].split("/"),i=0;i<hash.length;i++)0==i?r.page=hash[i].replace(/#/,""):r[i]=hash[i];if(obj.length>1)for(var search=/([^\?#&=]+)=([^&]*)/g;q=search.exec(obj[1]);)r[q[1]]=q[2]}return r},hashEventListener:function(){win.HashChangeEvent||function(){var lastURL=doc.URL;win.addEventListener("hashchange",function(event){Object.defineProperties(event,{oldURL:{enumerable:!0,configurable:!0,value:lastURL},newURL:{enumerable:!0,configurable:!0,value:doc.URL}}),lastURL=doc.URL})}()},meta:{locale:{script:{attr:{src:null},extension:".js",dir:"js/"},link:{attr:{rel:"stylesheet",href:null},extension:".css",dir:"css/"}},oblige:function(fileMeta){var file=[];for(var type in fileMeta)for(var src in fileMeta[type])file.push({type:type,name:fileMeta[type][src].replace(" ",".")});return file},append:function(deviceAgent){delete Config.Meta.agent,Config.Meta=this.oblige(Config.Meta).concat(deviceAgent),this.attach()},attach:function(){try{var o=this,x=Config.Meta.shift(),y=x.type,url=(x.dir||o.locale[y].dir)+x.name+o.locale[y].extension,req=doc.createElement(y);o.locale[y].attr.each(function(i,v){req[i]=v||url}),req.onerror=function(){o.attach()},req.onload=function(){app.root.notification(x.name),Config.Meta.length?o.attach():o.listen()},doc.head.appendChild(req)}catch(e){this.listen()}},listen:function(){Config.isCordova?(app.root.notification("class","icon-database").innerHTML="getting Device ready...",doc.addEventListener("deviceready",this.initiate,!1)):this.initiate()},initiate:function(){Config.Execute.each(function(i,v){i="object"==typeof v?Object.keys(v)[0]:v,app.root.execute.call(app.root,i.split(" "),v[i])})}},root:{todo:{},config:{Meta:{agent:{script:[0,1,2],link:[0,1,2]}},Execute:["Action"],T:[],Handler:"ontouchstart"in document.documentElement?"touchstart":"click",On:"fO",Screen:"desktop",Platform:"web",Layout:null,Browser:"chrome",fileSystask:"Chrome",Orientation:{change:"D1699",landscape:"landscape",portrait:"portrait",html:"html"},note:{},lang:{},query:{},hash:{},lookup:{setting:{},book:{}},previous:{},todo:{Orientation:!0},container:{},msg:{info:"#msg"},name:"app",version:"1.0",build:"1"},scriptive:{version:"1.0.2.2016.12.13"},document:function(response){response.merge({config:{}}),Config=this.config.merge(response.config),app.ready(function(event){response.hasOwnProperty("ready")&&response.ready.call(app.root,event),"string"==typeof Config.msg.info&&(Config.msg.info=doc.querySelector(Config.msg.info)),"string"==typeof Config.id?Config.id.search(obUnique)<0?Config.idUnique=Config.id+obUnique:Config.idUnique=Config.id:Config.idUnique=ob+obUnique,"object"==typeof Config.Orientation&&app.device.orientate(Object.prototype.hasOwnProperty.call(window,"onorientationchange")?"orientationchange":"resize"),"object"==typeof Config.Meta?app.meta.append(app.device.agent(Config.Meta.agent)):app.meta.listen()})},notification:function(){if(null!==this.config.msg.info)return arguments.length>1?this.config.msg.info.setAttribute(arguments[0],arguments[1]):this.config.msg.info.innerHTML=arguments[0],this.config.msg.info},execute:function(x,y){var i=x.shift();if(this.hasOwnProperty(i)){if(this.isFunction(i))return this[i](y);if(x.length)return app.root.execute.call(this[i],x,y)}return!1},handler:function(){for(var element=doc.getElementsByClassName(Config.On),i=0;i<element.length;i++)element[i].addEventListener(Config.Handler,function(event){var query=this.getAttribute("class").split(" ").filter(function(e){return e}).remove(Config.On);app.root.execute.call(app.root,query,event)})},metaLink:function(){arguments[0].each(function(i,v){win[v]=doc.querySelector("link[rel=0]".replace(0,v)).getAttribute("href")})},metaContent:function(){arguments[0].each(function(i,v){win[v]=doc.querySelector("meta[name=0]".replace(0,v)).getAttribute("content")})},localStorage:{name:{},storage:win.localStorage,select:function(key,val){var val=this.storage.getItem(this.ids(key));try{this.name[key]=val?JSON.parse(val):{}}catch(e){this.name[key]=val}finally{return this}},insert:function(key,val){var id=this.ids(key);return"object"==typeof val?this.storage.setItem(id,JSON.stringify(val)):this.storage.setItem(id,val),this.name[key]=val,this},update:function(key,val){return this.insert(key,val||this.name[key])},delete:function(key){return this.storage.removeItem(this.ids(key)),this},ids:function(key){return app.root.config.idUnique.replace(/unique/,key)}},hashChange:function(callback){return win.addEventListener("hashchange",function(event){app.hash(),"function"==typeof callback&&callback(event)},!1),app.hash()}}};win[os]=function(a){return new app.init(a)}}("scriptive",window,document),Object.defineProperties(Object.prototype,{merge:{enumerable:!1,value:function(src){for(var i in src)try{src[i].constructor==Object?this[i].merge(src[i]):this[i]=src[i]}catch(e){this[i]=src[i]}return this}},each:{value:function(callback){var obj={object:function(o){for(var i in o)callback(i,o[i],o)},array:function(o){for(var i=0,len=o.length;i<len;i++)callback(o,i,o[i])}};return obj[typeof this](this)}},hasMethodProperty:{value:function(o){return this.hasOwnProperty(o)&&this.isFunction(o)}},isFunction:{value:function(o){return"function"==typeof this[o]}}}),Object.defineProperties(Array.prototype,{remove:{value:function(){for(var item,x,o=arguments,i=o.length;i&&this.length;)for(item=o[--i];(x=this.indexOf(item))!==-1;)this.splice(x,1);return this}}});